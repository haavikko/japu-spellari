<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spelling Bee Practice</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom animations */
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .shake {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-indigo-100 to-purple-200 min-h-screen flex items-center justify-center p-4 font-sans text-slate-800">

    <div class="bg-white w-full max-w-lg rounded-2xl shadow-xl overflow-hidden min-h-[400px] flex flex-col relative">
        
        <!-- Header -->
        <div class="bg-indigo-600 p-4 text-white text-center">
            <h1 class="text-2xl font-bold tracking-wide">Spelling Bee üêù</h1>
        </div>

        <!-- Content Area -->
        <div class="p-6 flex-grow flex flex-col justify-center">

            <!-- VIEW 1: Input List -->
            <div id="setup-view" class="fade-in space-y-4">
                <div class="text-center space-y-2">
                    <h2 class="text-xl font-semibold text-indigo-900">Create Your List</h2>
                    <p class="text-sm text-slate-500">Enter words to practice, separated by commas or new lines.</p>
                </div>
                
                <textarea 
                    id="word-input" 
                    class="w-full h-40 p-3 border-2 border-slate-200 rounded-lg focus:border-indigo-500 focus:ring focus:ring-indigo-200 transition-all resize-none text-lg"
                    placeholder="example:&#10;separate&#10;necessary&#10;accommodate"
                ></textarea>

                <button onclick="app.startPractice()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 rounded-lg transition-colors shadow-md active:transform active:scale-95">
                    Start Practice
                </button>
            </div>

            <!-- VIEW 2: Practice Mode -->
            <div id="practice-view" class="hidden fade-in space-y-6 text-center">
                <div class="flex justify-between text-xs font-bold text-slate-400 uppercase tracking-widest">
                    <span id="progress-text">Word 1 of 5</span>
                    <span id="current-score-mini">Score: 0</span>
                </div>

                <div class="py-4">
                    <button onclick="app.speakCurrentWord()" class="group relative inline-flex items-center justify-center w-24 h-24 bg-indigo-100 rounded-full text-indigo-600 hover:bg-indigo-600 hover:text-white transition-all duration-300 shadow-inner hover:shadow-lg">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 group-hover:scale-110 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />
                        </svg>
                        <span class="absolute -bottom-8 text-sm text-slate-500 font-medium whitespace-nowrap group-hover:text-indigo-600">Click to Listen</span>
                    </button>
                </div>

                <div class="space-y-3">
                    <input 
                        type="text" 
                        id="user-spelling" 
                        class="w-full text-center text-2xl p-3 border-b-2 border-slate-300 focus:border-indigo-600 outline-none bg-transparent placeholder-slate-300 font-mono tracking-wide"
                        placeholder="Type spelling..."
                        autocomplete="off"
                        spellcheck="false"
                        onkeydown="if(event.key === 'Enter') app.checkAnswer()"
                    >
                    <button onclick="app.checkAnswer()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 rounded-lg mt-4 transition-colors shadow-md">
                        Submit Answer
                    </button>
                </div>
            </div>

            <!-- VIEW 3: Feedback -->
            <div id="feedback-view" class="hidden fade-in text-center space-y-6">
                <div id="feedback-icon" class="text-6xl animate-bounce">
                    <!-- Filled by JS -->
                </div>
                
                <div class="space-y-2">
                    <h2 id="feedback-title" class="text-2xl font-bold">
                        <!-- Correct/Incorrect -->
                    </h2>
                    
                    <div id="correction-area" class="hidden bg-red-50 p-4 rounded-lg border border-red-100">
                        <p class="text-sm text-red-500 uppercase tracking-wide font-bold">Correct Spelling:</p>
                        <p id="correct-spelling-display" class="text-xl font-mono text-slate-800 font-bold mt-1 tracking-widest"></p>
                    </div>

                    <div id="success-area" class="hidden">
                        <p class="text-slate-600">Spot on! üéâ</p>
                    </div>
                </div>

                <button id="next-btn" onclick="app.nextWord()" class="w-full bg-slate-800 hover:bg-slate-900 text-white font-bold py-3 rounded-lg transition-colors shadow-md">
                    Next Word
                </button>
            </div>

            <!-- VIEW 4: Results -->
            <div id="results-view" class="hidden fade-in text-center space-y-6">
                <h2 class="text-3xl font-bold text-indigo-900">Practice Complete!</h2>
                
                <div class="py-4">
                    <div class="text-6xl font-black text-indigo-600" id="final-score">0%</div>
                    <p class="text-slate-500 mt-2" id="score-details">0 out of 0 correct</p>
                </div>

                <div class="bg-indigo-50 p-4 rounded-lg">
                    <p class="text-sm text-indigo-800 mb-2">Words needing practice:</p>
                    <ul id="missed-words-list" class="text-left text-sm space-y-1 list-disc list-inside text-slate-700 max-h-32 overflow-y-auto">
                        <!-- Filled by JS -->
                    </ul>
                    <p id="perfect-score-msg" class="hidden text-indigo-600 font-bold">None! You are a spelling wizard! üßô‚Äç‚ôÇÔ∏è</p>
                </div>

                <div class="grid gap-3">
                    <button id="btn-retry-missed" onclick="app.retryMissed()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 rounded-lg transition-colors shadow-md">
                        Practice Missed Words
                    </button>
                    <button onclick="app.restartFull()" class="w-full bg-white border-2 border-indigo-600 text-indigo-600 hover:bg-indigo-50 font-bold py-3 rounded-lg transition-colors shadow-sm">
                        Restart Same List
                    </button>
                    <button onclick="app.reset()" class="w-full text-slate-500 hover:text-slate-700 font-semibold py-2 transition-colors text-sm">
                        Start New List
                    </button>
                </div>
            </div>

        </div>
    </div>

    <script>
        const app = {
            sourceWords: [], // Store original list
            words: [],
            currentIndex: 0,
            score: 0,
            missedWords: [],
            synth: window.speechSynthesis,
            
            // DOM Elements
            views: {
                setup: document.getElementById('setup-view'),
                practice: document.getElementById('practice-view'),
                feedback: document.getElementById('feedback-view'),
                results: document.getElementById('results-view')
            },
            input: document.getElementById('word-input'),
            userSpelling: document.getElementById('user-spelling'),

            init() {
                // Check if speech synthesis is supported
                if (!window.speechSynthesis) {
                    // Using console.error instead of alert due to development environment constraints
                    console.error("Browser does not support Text-to-Speech.");
                }
            },

            showView(viewName) {
                Object.values(this.views).forEach(el => el.classList.add('hidden'));
                this.views[viewName].classList.remove('hidden');
                
                // Auto focus specific inputs
                if(viewName === 'practice') setTimeout(() => this.userSpelling.focus(), 100);
                if(viewName === 'setup') setTimeout(() => this.input.focus(), 100);
                if(viewName === 'feedback') setTimeout(() => document.getElementById('next-btn').focus(), 100);
            },

            startPractice() {
                const rawText = this.input.value.trim();
                
                if (!rawText) {
                    this.input.parentElement.classList.add('shake');
                    setTimeout(() => this.input.parentElement.classList.remove('shake'), 500);
                    return;
                }

                // Split by newlines or commas, filter empty strings
                this.sourceWords = rawText.split(/[\n,]+/).map(w => w.trim()).filter(w => w.length > 0);
                
                if (this.sourceWords.length === 0) return;

                // Clear the input text box after the words have been successfully captured
                this.input.value = '';

                this.runGame(this.sourceWords);
            },

            runGame(wordList) {
                // BUG FIX: Clear the spelling input field at the start of any new round (restart, retry, or initial start)
                this.userSpelling.value = '';

                // Create a copy to avoid modifying source
                this.words = [...wordList];

                // Randomize list (Fisher-Yates shuffle)
                for (let i = this.words.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [this.words[i], this.words[j]] = [this.words[j], this.words[i]];
                }

                this.currentIndex = 0;
                this.score = 0;
                this.missedWords = [];
                
                this.updateProgress();
                this.showView('practice');
                
                // Slight delay to allow view transition before speaking
                setTimeout(() => this.speakCurrentWord(), 500);
            },

            restartFull() {
                this.runGame(this.sourceWords);
            },

            retryMissed() {
                if (this.missedWords.length > 0) {
                    this.runGame(this.missedWords);
                }
            },

            updateProgress() {
                document.getElementById('progress-text').textContent = `Word ${this.currentIndex + 1} of ${this.words.length}`;
                document.getElementById('current-score-mini').textContent = `Score: ${this.score}`;
            },

            speakCurrentWord() {
                // Cancel any currently playing speech to prevent overlap
                this.synth.cancel();

                const word = this.words[this.currentIndex];
                const utterance = new SpeechSynthesisUtterance(word);
                utterance.lang = 'en-US'; // American English
                utterance.rate = 0.9; // Slightly slower for clarity
                
                this.synth.speak(utterance);
                this.userSpelling.focus();
            },

            checkAnswer() {
                const targetWord = this.words[this.currentIndex];
                const userAttempt = this.userSpelling.value.trim();
                
                if (!userAttempt) return; // Don't submit empty

                const isCorrect = userAttempt.toLowerCase() === targetWord.toLowerCase();
                
                if (isCorrect) {
                    this.score++;
                } else {
                    // Check if the word is already in the missed list (in case of retryMissed loop)
                    if (!this.missedWords.includes(targetWord)) {
                        this.missedWords.push(targetWord);
                    }
                }

                this.showFeedback(isCorrect, targetWord);
            },

            showFeedback(isCorrect, targetWord) {
                const icon = document.getElementById('feedback-icon');
                const title = document.getElementById('feedback-title');
                const correctionArea = document.getElementById('correction-area');
                const successArea = document.getElementById('success-area');
                const nextBtn = document.getElementById('next-btn');

                if (isCorrect) {
                    icon.innerHTML = '‚úÖ';
                    title.textContent = 'Correct!';
                    title.className = 'text-2xl font-bold text-green-600';
                    correctionArea.classList.add('hidden');
                    successArea.classList.remove('hidden');
                } else {
                    icon.innerHTML = '‚ùå';
                    title.textContent = 'Incorrect';
                    title.className = 'text-2xl font-bold text-red-600';
                    correctionArea.classList.remove('hidden');
                    successArea.classList.add('hidden');
                    document.getElementById('correct-spelling-display').textContent = targetWord;
                }
                
                // Change button text if it's the last word
                if (this.currentIndex >= this.words.length - 1) {
                    nextBtn.textContent = "See Results";
                } else {
                    nextBtn.textContent = "Next Word";
                }

                this.showView('feedback');
            },

            nextWord() {
                this.currentIndex++;
                
                if (this.currentIndex < this.words.length) {
                    this.userSpelling.value = ''; // Clear input
                    this.updateProgress();
                    this.showView('practice');
                    setTimeout(() => this.speakCurrentWord(), 300);
                } else {
                    this.finishGame();
                }
            },

            finishGame() {
                const percentage = Math.round((this.score / this.words.length) * 100);
                
                document.getElementById('final-score').textContent = `${percentage}%`;
                document.getElementById('score-details').textContent = `${this.score} out of ${this.words.length} correct`;

                const list = document.getElementById('missed-words-list');
                const perfectMsg = document.getElementById('perfect-score-msg');
                const retryBtn = document.getElementById('btn-retry-missed');
                
                list.innerHTML = '';
                
                if (this.missedWords.length === 0) {
                    list.classList.add('hidden');
                    perfectMsg.classList.remove('hidden');
                    retryBtn.classList.add('hidden'); // Hide retry missed option if perfect score
                } else {
                    list.classList.remove('hidden');
                    perfectMsg.classList.add('hidden');
                    retryBtn.classList.remove('hidden');
                    
                    // Show only unique missed words
                    [...new Set(this.missedWords)].forEach(word => {
                        const li = document.createElement('li');
                        li.textContent = word;
                        list.appendChild(li);
                    });
                }

                this.showView('results');
            },

            // This function handles the "Start New List" button
            reset() {
                // Ensure the list input box is cleared
                this.input.value = ''; 
                // Ensure the spelling input box is cleared (belt-and-suspenders approach)
                this.userSpelling.value = '';
                this.showView('setup');
            }
        };

        // Initialize on load
        app.init();
    </script>
</body>
</html>